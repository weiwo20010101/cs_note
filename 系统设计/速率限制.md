# 速率限制

## 限流指标

### TPS

Transaction 事务，交易

系统吞吐量是衡量系统性能的关键指标，**按照事务的完成数量**来限流是最合理的。

但是对实操性来说，按照事务来限流并不现实。**在分布式系统**中完成一笔事务需要多个系统的配合。比如我们在电商系统购物，需要订单、库存、账户、支付等多个服务配合完成，**有的服务需要异步返回**，这样完成一笔事务花费的时间可能会很长。**如果按照`TPS`来进行限流，时间粒度可能会很大大，很难准确评估系统的响应性能**。

### HPS

Hits

是指在一秒钟的时间内用户对Web页面的链接、提交按钮等点击总和。 它一般和TPS成正比关系

如果一个请求完成一笔事务，那`TPS`和`HPS`是等同的。但在分布式场景下，完成一笔事务可能需要多次请求，所以`TPS`和`HPS`指标不能等同看待。

### QPS

服务端每秒能够响应的客户端查询请求数量。

### 

》目前主流的限流方法多采用HPS作为限流指标。

## 好处

1. 避免因为拒绝服务攻击而耗尽资源
1. 减少开支，限制过多的请求有煮鱼减少所需的服务器数量，降低成本开支
1. 确保服务器正常工作而不超负荷

## 方法

固定窗口，滑动窗口，令牌桶（匀速向桶中放入令牌），漏桶（不限制流入，匀速流出）

》令牌桶中的令牌可以预装入，在应对流量洪峰的时候，表现比漏桶算法更加优异。

》实习项目中使用redis实现的滑动窗口算法

